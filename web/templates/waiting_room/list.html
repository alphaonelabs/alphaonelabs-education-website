{% extends "base.html" %}
{% load dict_filters %}
{% block title %}Waiting Rooms{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Waiting Rooms</h1>
        <a href="{% url 'create_waiting_room' %}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Create Waiting Room
        </a>
    </div>

    <div class="mb-10">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">What are Waiting Rooms?</h2>
        <p class="text-gray-600 mb-4">
            Waiting rooms allow you to express interest in subjects and topics you want to learn. 
            Join existing waiting rooms or create your own to find others interested in the same topics.
            Teachers can see these waiting rooms and create courses based on popular demand.
        </p>
    </div>

    <!-- Your Waiting Rooms -->
    {% if user_created_rooms or user_joined_rooms %}
    <div class="mb-10">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">Your Waiting Rooms</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for room in user_created_rooms %}
            <div class="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200 hover:shadow-lg transition-shadow duration-300">
                <div class="p-6">
                    <div class="flex justify-between items-start">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">{{ room.title }}</h3>
                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded">Created by you</span>
                    </div>
                    <p class="text-gray-600 mb-4">{{ room.description|truncatechars:100 }}</p>
                    <div class="mb-4">
                        <span class="font-medium text-gray-700">Subject:</span> {{ room.subject }}
                    </div>
                    <div class="mb-4">
                        <span class="font-medium text-gray-700">Topics:</span>
                        <div class="flex flex-wrap gap-2 mt-1">
                            {% for topic in room_topics|get_item:room.id %}
                            <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded">{{ topic }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500">{{ room.participants.count }} participant{{ room.participants.count|pluralize }}</span>
                        <a href="{% url 'waiting_room_detail' room.id %}" class="text-blue-600 hover:text-blue-800 font-medium">View Details</a>
                    </div>
                </div>
            </div>
            {% endfor %}
            
            {% for room in user_joined_rooms %}
            {% if room.creator != user %}
            <div class="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200 hover:shadow-lg transition-shadow duration-300">
                <div class="p-6">
                    <div class="flex justify-between items-start">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">{{ room.title }}</h3>
                        <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">Joined</span>
                    </div>
                    <p class="text-gray-600 mb-4">{{ room.description|truncatechars:100 }}</p>
                    <div class="mb-4">
                        <span class="font-medium text-gray-700">Subject:</span> {{ room.subject }}
                    </div>
                    <div class="mb-4">
                        <span class="font-medium text-gray-700">Topics:</span>
                        <div class="flex flex-wrap gap-2 mt-1">
                            {% for topic in room_topics|get_item:room.id %}
                            <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded">{{ topic }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500">{{ room.participants.count }} participant{{ room.participants.count|pluralize }}</span>
                        <a href="{% url 'waiting_room_detail' room.id %}" class="text-blue-600 hover:text-blue-800 font-medium">View Details</a>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Open Waiting Rooms -->
    <div>
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">Open Waiting Rooms</h2>
        {% if waiting_rooms %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for room in waiting_rooms %}
            {% if room not in user_joined_rooms and room.creator != user %}
            <div class="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200 hover:shadow-lg transition-shadow duration-300">
                <div class="p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">{{ room.title }}</h3>
                    <p class="text-gray-600 mb-4">{{ room.description|truncatechars:100 }}</p>
                    <div class="mb-4">
                        <span class="font-medium text-gray-700">Subject:</span> {{ room.subject }}
                    </div>
                    <div class="mb-4">
                        <span class="font-medium text-gray-700">Topics:</span>
                        <div class="flex flex-wrap gap-2 mt-1">
                            {% for topic in room_topics|get_item:room.id %}
                            <span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded">{{ topic }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500">{{ room.participants.count }} participant{{ room.participants.count|pluralize }}</span>
                        <a href="{% url 'waiting_room_detail' room.id %}" class="text-blue-600 hover:text-blue-800 font-medium">View Details</a>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        <div class="bg-gray-50 rounded-lg p-6 text-center">
            <p class="text-gray-600">No open waiting rooms available. Be the first to create one!</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
