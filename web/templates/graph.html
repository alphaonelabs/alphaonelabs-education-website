{% extends "base.html" %}

{% block title %}Graphing Calculator{% endblock %}

{% block content %}
<div class="container mx-auto p-6">
  <div class="bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6">
    <h1 class="text-3xl font-bold text-center mb-6">Graphing Calculator</h1>
    
    <!-- Equation Input & Buttons -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
      <div class="flex flex-col md:flex-row md:space-x-4 mb-4 md:mb-0">
        <input type="text" id="equationInput" 
               placeholder="Enter equation (e.g., y = x^2)" 
               class="flex-1 p-3 border rounded dark:bg-gray-700 dark:text-white" />
        <button onclick="addEquation()" 
                class="mt-2 md:mt-0 px-4 py-3 bg-blue-500 text-white rounded hover:bg-blue-600 transition">
          Plot Equation
        </button>
        <button onclick="clearAll()" 
                class="mt-2 md:mt-0 px-4 py-3 bg-red-500 text-white rounded hover:bg-red-600 transition">
          Clear All
        </button>
      </div>
      <!-- Function buttons for common math functions -->
      <div class="flex flex-wrap gap-2">
        <button onclick="appendToInput('sin(')" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">sin</button>
        <button onclick="appendToInput('cos(')" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">cos</button>
        <button onclick="appendToInput('tan(')" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">tan</button>
        <button onclick="appendToInput('log(')" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">log</button>
        <button onclick="appendToInput('sqrt(')" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">âˆš</button>
        <button onclick="appendToInput('^')" class="px-3 py-2 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">^</button>
      </div>
    </div>
    
    <div class="mb-4">
      <p class="text-sm text-gray-600 dark:text-gray-300">
        Try examples: 
        <span class="cursor-pointer text-blue-500" onclick="addExample('y = x^2')">Parabola</span>, 
        <span class="cursor-pointer text-blue-500" onclick="addExample('y = sin(x)')">Sine Wave</span>, 
        <span class="cursor-pointer text-blue-500" onclick="addExample('x^2 + y^2 = 25')">Circle</span>
      </p>
    </div>
    
    <!-- Desmos Calculator -->
    <div id="calculator" class="border rounded-lg overflow-hidden" style="height: 600px; width: 100%;"></div>
  </div>
</div>

<!-- Desmos Calculator CDN -->
<script src="https://www.desmos.com/api/v1.7/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
<script>
    // Initialize the Desmos calculator
    const calculator = Desmos.GraphingCalculator(document.getElementById('calculator'), {
        keypad: true,
        expressions: true,
        settingsMenu: true,
        expressionsCollapsed: false,
        backgroundColor: document.documentElement.classList.contains('dark') ? '#1f2937' : '#ffffff'
    });

    // Plot the equation from the input field
    function addEquation() {
        const eqInput = document.getElementById('equationInput');
        const equation = eqInput.value.trim();
        if (equation) {
            calculator.setExpression({
                id: 'eq' + Date.now(),
                latex: equation,
                color: Desmos.Colors.BLUE
            });
            eqInput.value = '';
        }
    }

    // Clear all equations from the calculator
    function clearAll() {
        calculator.setExpressions([]);
    }

    // Set an example equation
    function addExample(equation) {
        document.getElementById('equationInput').value = equation;
        addEquation();
    }

    // Append text to the input field (for function buttons)
    function appendToInput(text) {
        const eqInput = document.getElementById('equationInput');
        eqInput.value += text;
        eqInput.focus();
    }

    // Update calculator theme when dark mode changes
    function updateCalculatorTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        calculator.updateSettings({
            backgroundColor: isDark ? '#1f2937' : '#ffffff'
        });
    }

    // Observe changes in the document's class attribute (for dark mode toggling)
    new MutationObserver(updateCalculatorTheme).observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
    });

    // Initial theme update
    updateCalculatorTheme();
</script>
{% endblock %}
