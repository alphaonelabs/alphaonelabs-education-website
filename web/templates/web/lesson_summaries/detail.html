{% extends "base.html" %}

{% block title %}{{ summary.title }}{% endblock %}
{% block content %}
  <div class="container mx-auto px-4 py-8">
    <!-- Back Button -->
    <div class="mb-6">
      <a href="{% url 'lesson_summary_list' %}"
         class="inline-flex items-center text-teal-300 hover:text-teal-400">
        <i class="fas fa-arrow-left mr-2"></i> Back to Summaries
      </a>
    </div>
    <!-- Summary Card -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden max-w-4xl mx-auto">
      <div class="p-12 {% if summary.background_style == 'gradient1' %}bg-gradient-to-r from-teal-400 to-teal-200{% elif summary.background_style == 'gradient2' %}bg-gradient-to-r from-blue-400 to-blue-200{% elif summary.background_style == 'gradient3' %}bg-gradient-to-r from-purple-400 to-purple-200{% else %}bg-teal-300{% endif %}"
           id="summary-content">
        <div class="mb-4 flex items-center justify-between">
          <div>
            {% if summary.is_public %}
              <span class="inline-block px-4 py-2 bg-white bg-opacity-80 rounded-full text-sm font-medium text-gray-900">
                <i class="fas fa-globe mr-1"></i> Public
              </span>
            {% endif %}
            {% if summary.course %}
              <span class="inline-block px-4 py-2 bg-white bg-opacity-80 rounded-full text-sm font-medium text-gray-900 ml-2">
                <i class="fas fa-book mr-1"></i> {{ summary.course.title }}
              </span>
            {% endif %}
          </div>
        </div>
        <h1 class="text-4xl font-bold mb-6 text-gray-900">{{ summary.title }}</h1>
        <div class="mb-8">
          <h2 class="text-2xl font-semibold mb-4 text-gray-900">Key Learnings</h2>
          <div class="text-lg leading-relaxed text-gray-800 whitespace-pre-line">{{ summary.key_learnings }}</div>
        </div>
        {% if summary.additional_notes %}
          <div class="mb-6">
            <h2 class="text-2xl font-semibold mb-4 text-gray-900">Additional Notes</h2>
            <div class="text-lg leading-relaxed text-gray-800 whitespace-pre-line">{{ summary.additional_notes }}</div>
          </div>
        {% endif %}
        <div class="flex items-center space-x-6 text-sm text-gray-800 pt-6 border-t-2 border-gray-900 border-opacity-20">
          <div class="flex items-center">
            <i class="fas fa-user mr-2"></i>
            <span>{{ summary.user.username }}</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-calendar mr-2"></i>
            <span>{{ summary.date|date:"F d, Y" }}</span>
          </div>
        </div>
      </div>
      <!-- Actions -->
      <div class="bg-gray-50 dark:bg-gray-900 px-6 py-4">
        <div class="flex flex-wrap items-center justify-between gap-4">
          {% if summary.user == request.user %}
            <div class="flex items-center space-x-3">
              <a href="{% url 'lesson_summary_update' summary.pk %}"
                 class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition duration-200">
                <i class="fas fa-edit mr-2"></i> Edit
              </a>
              <a href="{% url 'lesson_summary_delete' summary.pk %}"
                 class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition duration-200">
                <i class="fas fa-trash mr-2"></i> Delete
              </a>
            </div>
          {% endif %}
          <div class="flex items-center space-x-3">
            <button onclick="shareSummary()"
                    class="px-4 py-2 bg-teal-300 hover:bg-teal-400 text-gray-900 rounded-lg transition duration-200">
              <i class="fas fa-share-alt mr-2"></i> Share
            </button>
            <button onclick="downloadSummary()"
                    class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition duration-200">
              <i class="fas fa-download mr-2"></i> Download
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
      function shareSummary() {
          const url = window.location.href;
          navigator.clipboard.writeText(url).then(() => {
              alert('Link copied to clipboard! Share your learning journey with others.');
          });
      }

      function downloadSummary() {
          const element = document.getElementById('summary-content');
          html2canvas(element, {
              scale: 2
          }).then(canvas => {
              const link = document.createElement('a');
              link.download = 'what-i-learned-{{ summary.date|date:"Y-m-d" }}.png';
              link.href = canvas.toDataURL();
              link.click();
          });
      }
  </script>
{% endblock %}
