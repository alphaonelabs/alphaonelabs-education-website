{% extends "base.html" %}

{% block title %}Your Learning Maps{% endblock %}
{% block content %}
  <div class="container mx-auto px-4 py-8">
    <!-- Header and create button -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Your Learning Maps</h1>
      <button id="create-map-btn"
              class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center">
        <svg class="w-4 h-4 mr-1"
             fill="none"
             stroke="currentColor"
             viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        Create New Map
      </button>
    </div>
    <!-- Create Map Form (initially hidden) -->
    <div id="create-map-form"
         class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8 hidden">
      <h2 class="text-xl font-semibold mb-4">Create New Learning Map</h2>
      <form method="post"
            action="{% url 'learning_map_list' %}"
            class="space-y-4">
        {% csrf_token %}
        <div>
          <label for="title" class="block text-sm font-medium mb-2">Map Title</label>
          <input type="text"
                 id="title"
                 name="title"
                 required
                 class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700" />
        </div>
        <div>
          <label for="description" class="block text-sm font-medium mb-2">Description (optional)</label>
          <textarea id="description"
                    name="description"
                    rows="3"
                    class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700"></textarea>
        </div>
        <div>
          <label class="inline-flex items-center">
            <input type="checkbox" name="public" class="form-checkbox" />
            <span class="ml-2">Make this map public</span>
          </label>
          <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
            Public maps can be shared with anyone. You can change this setting later.
          </p>
        </div>
        <div class="flex justify-end space-x-2">
          <button type="button"
                  id="cancel-create-btn"
                  class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
            Cancel
          </button>
          <button type="submit"
                  class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Create Map</button>
        </div>
      </form>
    </div>
    <!-- Maps Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for map in maps %}
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
          <div class="p-6">
            <h2 class="text-xl font-semibold mb-2">{{ map.title }}</h2>
            {% if map.description %}
              <p class="text-gray-600 dark:text-gray-400 mb-4">{{ map.description|truncatechars:100 }}</p>
            {% endif %}
            <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-4">
              <svg class="w-4 h-4 mr-1"
                   fill="none"
                   stroke="currentColor"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z">
                </path>
              </svg>
              <span>Created {{ map.created_at|date:"M d, Y" }}</span>
              {% if map.public %}
                <span class="ml-3 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                  Public
                </span>
              {% else %}
                <span class="ml-3 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200">
                  Private
                </span>
              {% endif %}
            </div>
            <div class="flex justify-between">
              <a href="{% url 'learning_map_detail' map.slug %}"
                 class="text-blue-600 hover:underline">View Map</a>
              <a href="{% url 'share_learning_map' map.slug %}"
                 class="text-green-600 hover:underline flex items-center">
                <svg class="w-4 h-4 mr-1"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z">
                  </path>
                </svg>
                Share
              </a>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-span-full bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center">
          <svg class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-500 mb-4"
               fill="none"
               stroke="currentColor"
               viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7">
            </path>
          </svg>
          <h2 class="text-xl font-semibold mb-2">No Learning Maps Yet</h2>
          <p class="text-gray-600 dark:text-gray-400 mb-4">
            Create your first learning map to start tracking your educational journey.
          </p>
          <button id="create-first-map-btn"
                  class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Create Your First Map</button>
        </div>
      {% endfor %}
    </div>
  </div>
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const createMapBtn = document.getElementById('create-map-btn');
          const createFirstMapBtn = document.getElementById('create-first-map-btn');
          const createMapForm = document.getElementById('create-map-form');
          const cancelCreateBtn = document.getElementById('cancel-create-btn');

          // Function to show the create map form
          function showCreateForm() {
              createMapForm.classList.remove('hidden');
              createMapBtn.classList.add('hidden');
              // Scroll to form
              window.scrollTo({
                  top: createMapForm.offsetTop - 20,
                  behavior: 'smooth'
              });
              // Focus on title input
              document.getElementById('title').focus();
          }

          // Function to hide the create map form
          function hideCreateForm() {
              createMapForm.classList.add('hidden');
              createMapBtn.classList.remove('hidden');
          }

          // Event listeners
          if (createMapBtn) {
              createMapBtn.addEventListener('click', showCreateForm);
          }

          if (createFirstMapBtn) {
              createFirstMapBtn.addEventListener('click', showCreateForm);
          }

          if (cancelCreateBtn) {
              cancelCreateBtn.addEventListener('click', hideCreateForm);
          }
      });
  </script>
{% endblock %}
