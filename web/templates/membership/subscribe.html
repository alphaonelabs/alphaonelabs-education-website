{% extends "base.html" %}

{% load static %}
{% load custom_filters %}

{% block title %}Subscribe to {{ plan.name }} Membership{% endblock %}
{% block extra_head %}
  <style>
      .pricing-card {
          transition: all 0.3s ease;
      }

      .pricing-card:hover {
          transform: translateY(-8px);
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }

      .save-badge {
          animation: pulse-badge 2s infinite;
          z-index: 10;
      }

      @keyframes pulse-badge {
          0% {
              transform: rotate(3deg) scale(1);
          }

          50% {
              transform: rotate(3deg) scale(1.05);
          }

          100% {
              transform: rotate(3deg) scale(1);
          }
      }

      .bg-pattern {
          background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      }

      .feature-icon {
          transition: all 0.2s ease;
      }

      .pricing-card:hover .feature-icon {
          transform: scale(1.1) rotate(10deg);
      }

      /* Selected pricing card styles */
      .pricing-card.border-blue-600 {
          box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.4);
      }

      .dark .pricing-card.border-blue-500 {
          box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.3);
      }

      /* Feature list animations */
      .feature-list li {
          opacity: 0;
          transform: translateY(10px);
          animation: fade-in-up 0.6s forwards;
      }

      @keyframes fade-in-up {
          to {
              opacity: 1;
              transform: translateY(0);
          }
      }

      .feature-list li:nth-child(1) {
          animation-delay: 0.1s;
      }

      .feature-list li:nth-child(2) {
          animation-delay: 0.2s;
      }

      .feature-list li:nth-child(3) {
          animation-delay: 0.3s;
      }

      /* Card highlight animations */
      .pricing-highlight {
          position: relative;
          overflow: hidden;
      }

      .pricing-highlight::after {
          content: '';
          position: absolute;
          top: 0;
          right: 0;
          width: 5px;
          height: 100%;
          background: linear-gradient(to bottom, #3b82f6, #2563eb);
          opacity: 0;
          transition: opacity 0.3s ease;
      }

      .pricing-card:hover .pricing-highlight::after {
          opacity: 1;
      }

      /* Button shine effect */
      .cta-button {
          position: relative;
          overflow: hidden;
      }

      .cta-button::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
          transition: 0.5s;
      }

      .cta-button:hover::before {
          left: 100%;
      }

      /* Back button animation */
      .back-button {
          transition: all 0.3s ease;
      }

      .back-button:hover {
          transform: translateX(-5px);
      }

      /* Section animations */
      .section-fade-in {
          opacity: 0;
          transform: translateY(20px);
          transition: all 0.8s ease;
      }

      .section-fade-in.active {
          opacity: 1;
          transform: translateY(0);
      }

      /* Floating blobs */
      @keyframes blob-movement {

          0%,
          100% {
              transform: translate(0px, 0px) scale(1);
          }

          25% {
              transform: translate(20px, -30px) scale(1.1);
          }

          50% {
              transform: translate(-20px, 20px) scale(0.9);
          }

          75% {
              transform: translate(30px, 30px) scale(1.05);
          }
      }

      .animate-blob {
          animation: blob-movement 18s infinite alternate;
      }

      .animation-delay-2000 {
          animation-delay: 2s;
      }
  </style>
  <script>
      // Observer for section animations
      document.addEventListener('DOMContentLoaded', function() {
          const observerOptions = {
              root: null,
              rootMargin: '0px',
              threshold: 0.1
          };

          const observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      entry.target.classList.add('active');
                      observer.unobserve(entry.target);
                  }
              });
          }, observerOptions);

          document.querySelectorAll('.section-fade-in').forEach(section => {
              observer.observe(section);
          });
      });
  </script>
{% endblock %}
{% block content %}
  <div class="min-h-screen bg-gradient-to-b from-blue-50 to-white dark:from-gray-900 dark:to-gray-800 bg-pattern">
    <div class="container mx-auto py-16 px-4 max-w-4xl relative">
      <!-- Background decorations -->
      <div class="absolute top-0 left-0 w-64 h-64 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob">
      </div>
      <div class="absolute bottom-0 right-0 w-64 h-64 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob animation-delay-2000">
      </div>
      <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden border border-gray-100 dark:border-gray-700 relative z-10">
        <!-- Header with back button -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-8 text-white relative overflow-hidden">
          <div class="absolute inset-0 opacity-20">
            <svg width="100%"
                 height="100%"
                 viewBox="0 0 800 800"
                 xmlns="http://www.w3.org/2000/svg">
              <defs>
              <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
              <path d="M 0 10 L 40 10 M 10 0 L 10 40" fill="none" stroke="white" stroke-width="1" />
              </pattern>
              </defs>
              <rect width="100%" height="100%" fill="url(#grid)" />
            </svg>
          </div>
          <div class="flex justify-between items-center relative z-10">
            <a href="{% url 'membership_plans' %}?billing={{ billing_period }}"
               class="back-button flex items-center text-white/90 hover:text-white font-medium transition-all duration-300 group">
              <svg class="w-5 h-5 mr-2 transform group-hover:translate-x-[-4px] transition-transform duration-300"
                   fill="none"
                   stroke="currentColor"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              <span>Back to Plans</span>
            </a>
            <div class="py-1 px-3 bg-white/20 rounded-lg text-sm font-medium animate-pulse">Step 1 of 2</div>
          </div>
          <h1 class="text-4xl font-bold mt-6 section-fade-in">Subscribe to {{ plan.name }}</h1>
          <p class="mt-2 text-blue-100 max-w-xl section-fade-in">
            Choose your preferred billing cycle and proceed to payment to activate your membership.
          </p>
        </div>
        <div class="p-8">
          <div class="flex flex-col space-y-8">
            <!-- Plan details -->
            <div class="bg-blue-50 dark:bg-blue-900/20 p-6 rounded-xl section-fade-in">
              <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white flex items-center">
                <svg class="w-6 h-6 text-blue-600 dark:text-blue-400 mr-3"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z">
                  </path>
                </svg>
                {{ plan.name }} Plan Includes:
              </h2>
              <ul class="space-y-3 grid md:grid-cols-2 gap-x-4 gap-y-3 feature-list">
                {% for feature in plan.features %}
                  <li class="flex items-center text-gray-700 dark:text-gray-200">
                    <svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-2 flex-shrink-0 feature-icon"
                         fill="none"
                         stroke="currentColor"
                         viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>{{ feature }}</span>
                  </li>
                {% endfor %}
              </ul>
            </div>
            <!-- Billing preference -->
            <div class="pt-6 section-fade-in">
              <h2 class="text-2xl font-semibold mb-8 text-gray-900 dark:text-white text-center">Choose your billing preference</h2>
              {% calculate_yearly_savings plan.price_monthly plan.price_yearly as yearly_savings %}
              {% calculate_savings_percent plan.price_monthly plan.price_yearly as savings_percent %}
              {% calculate_monthly_equivalent plan.price_yearly as monthly_equivalent %}
              <!-- Pricing Cards -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-8 section-fade-in">
                <a href="{% url 'checkout_membership' plan.slug 'monthly' %}"
                   class="pricing-card bg-white dark:bg-gray-700 border-2 {% if billing_period == 'monthly' %}border-blue-600 dark:border-blue-500 shadow-xl{% else %}border-gray-200 dark:border-gray-600{% endif %} rounded-xl hover:border-blue-500 dark:hover:border-blue-400 hover:shadow-lg">
                  <div class="p-8 flex flex-col h-full relative pricing-highlight">
                    <!-- Badge if selected -->
                    {% if billing_period == 'monthly' %}
                      <div class="absolute top-4 right-4">
                        <span class="bg-blue-600 text-white text-xs font-bold py-1.5 px-3 rounded-full shadow-md animate-pulse">Selected</span>
                      </div>
                    {% endif %}
                    <div class="mb-5">
                      <span class="inline-block px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full font-medium">Monthly Billing</span>
                    </div>
                    <div class="flex-grow">
                      <div class="flex items-baseline mb-3">
                        <span class="text-4xl font-bold text-gray-900 dark:text-white">${{ plan.price_monthly }}</span>
                        <span class="text-base text-gray-600 dark:text-gray-300 ml-2">/month</span>
                      </div>
                      <p class="text-gray-700 dark:text-gray-200 mb-6">Flexible month-to-month billing with no long-term commitment</p>
                      <ul class="space-y-3 mb-6 feature-list">
                        <li class="flex items-center text-gray-700 dark:text-gray-200">
                          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 feature-icon"
                               fill="none"
                               stroke="currentColor"
                               viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                          Cancel anytime
                        </li>
                        <li class="flex items-center text-gray-700 dark:text-gray-200">
                          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 feature-icon"
                               fill="none"
                               stroke="currentColor"
                               viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                          All plan features included
                        </li>
                        <li class="flex items-center text-gray-700 dark:text-gray-200">
                          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 feature-icon"
                               fill="none"
                               stroke="currentColor"
                               viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                          Pay as you go
                        </li>
                      </ul>
                    </div>
                    <button class="mt-6 py-5 px-8 w-full rounded-lg shadow-md cta-button text-lg {% if billing_period == 'monthly' %}bg-blue-600 text-white hover:bg-blue-700 ring-4 ring-blue-100 dark:ring-blue-900/30{% else %}bg-white dark:bg-gray-700 text-blue-700 dark:text-blue-300 border-2 border-blue-600 dark:border-blue-400 hover:bg-blue-50 dark:hover:bg-gray-600{% endif %} transition duration-300 font-medium">
                      Continue with Monthly
                    </button>
                  </div>
                </a>
                <a href="{% url 'checkout_membership' plan.slug 'yearly' %}"
                   class="pricing-card bg-white dark:bg-gray-700 border-2 {% if billing_period == 'yearly' %}border-blue-600 dark:border-blue-500 shadow-xl{% else %}border-gray-200 dark:border-gray-600{% endif %} rounded-xl hover:border-blue-500 dark:hover:border-blue-400 hover:shadow-lg relative">
                  <!-- Savings Badge - Improved alignment -->
                  <div class="absolute -top-3 -right-3 save-badge">
                    <div class="bg-green-600 text-white text-sm font-bold px-4 py-2 rounded-md shadow-lg">SAVE {{ savings_percent }}%</div>
                  </div>
                  <div class="p-8 flex flex-col h-full relative pricing-highlight">
                    <!-- Badge if selected -->
                    {% if billing_period == 'yearly' %}
                      <div class="absolute top-4 right-4">
                        <span class="bg-blue-600 text-white text-xs font-bold py-1.5 px-3 rounded-full shadow-md animate-pulse">Selected</span>
                      </div>
                    {% endif %}
                    <div class="mb-5">
                      <span class="inline-block px-4 py-2 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full font-medium">Annual Billing</span>
                    </div>
                    <div class="flex-grow">
                      <div class="flex items-baseline mb-3">
                        <span class="text-4xl font-bold text-gray-900 dark:text-white">${{ plan.price_yearly }}</span>
                        <span class="text-base text-gray-600 dark:text-gray-300 ml-2">/year</span>
                      </div>
                      <p class="text-gray-700 dark:text-gray-200 mb-2">Best value â€” save ${{ yearly_savings }} per year</p>
                      <div class="text-sm text-gray-600 dark:text-gray-300 mb-6 bg-gray-100 dark:bg-gray-600 p-2 rounded-lg flex items-center justify-center">
                        That's only ${{ monthly_equivalent|floatformat:2 }}/month
                      </div>
                      <ul class="space-y-3 mb-6 feature-list">
                        <li class="flex items-center text-gray-700 dark:text-gray-200">
                          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 feature-icon"
                               fill="none"
                               stroke="currentColor"
                               viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                          {{ savings_percent }}% discount
                        </li>
                        <li class="flex items-center text-gray-700 dark:text-gray-200">
                          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 feature-icon"
                               fill="none"
                               stroke="currentColor"
                               viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                          All plan features included
                        </li>
                        <li class="flex items-center text-gray-700 dark:text-gray-200">
                          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mr-3 feature-icon"
                               fill="none"
                               stroke="currentColor"
                               viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                          Priority support
                        </li>
                      </ul>
                    </div>
                    <button class="mt-6 py-5 px-8 w-full rounded-lg shadow-lg cta-button text-lg {% if billing_period == 'yearly' %}bg-blue-600 text-white hover:bg-blue-700 ring-4 ring-blue-100 dark:ring-blue-900/30{% else %}bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800{% endif %} transition duration-300 font-medium">
                      Continue with Yearly
                    </button>
                  </div>
                </a>
              </div>
            </div>
            <!-- Terms info -->
            <div class="mt-8 bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl text-center text-base text-gray-600 dark:text-gray-300 max-w-xl mx-auto section-fade-in">
              <p>
                By subscribing, you agree to our <a href="{% url 'terms' %}"
    class="text-blue-700 dark:text-blue-400 hover:underline font-medium">Terms of Service</a> and authorize us to charge your payment method on a recurring basis.
              </p>
              <p class="mt-3 flex items-center justify-center">
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 mr-2 animate-pulse"
                     fill="none"
                     stroke="currentColor"
                     viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                  </path>
                </svg>
                You can cancel your subscription at any time from your account settings.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
