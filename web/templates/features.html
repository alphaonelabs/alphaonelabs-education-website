{% extends "base.html" %}

{% load static %}

{% block title %}Features - AlphaOne Labs{% endblock %}
{% block extra_head %}
  <style>
      /* Enhanced Card Styles */
      .feature-card {
          transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          border: 1px solid #e2e8f0;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
          transform: translateY(0);
          overflow: hidden;
          position: relative;
          background: linear-gradient(145deg, #ffffff, #f8fafc);
      }

      .dark .feature-card {
          background: linear-gradient(145deg, #1f2937, #111827);
      }

      .feature-card:hover {
          transform: translateY(-12px) scale(1.02);
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .feature-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: linear-gradient(45deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
          opacity: 0;
          transition: opacity 0.4s ease;
          z-index: 0;
      }

      .feature-card:hover::before {
          opacity: 1;
      }

      /* Enhanced Image Styles */
      .feature-image {
          height: 180px;
          width: 100%;
          object-fit: cover;
          transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
          border-bottom: 1px solid #e2e8f0;
          filter: brightness(0.95);
      }

      .feature-card:hover .feature-image {
          transform: scale(1.08);
          filter: brightness(1);
      }

      /* Enhanced Badge Styles */
      .feature-badge {
          position: absolute;
          top: -10px;
          right: -10px;
          animation: float 3s ease-in-out infinite;
          background: linear-gradient(135deg, #3b82f6, #2563eb);
          padding: 8px 16px;
          border-radius: 9999px;
          font-weight: 600;
          letter-spacing: 0.5px;
          box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      }

      /* Enhanced Button Styles */
      .thumbs-button {
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          position: relative;
          overflow: hidden;
          border: 2px solid transparent;
      }

      .thumbs-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .thumbs-button:active {
          transform: translateY(0);
      }

      .thumbs-up.selected {
          background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
          border-color: #10B981;
          color: #10B981;
          transform: scale(1.05);
      }

      .thumbs-down.selected {
          background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
          border-color: #EF4444;
          color: #EF4444;
          transform: scale(1.05);
      }

      /* Enhanced Progress Bar */
      .vote-percentage-bar {
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 8px;
          background: rgba(243, 244, 246, 0.5);
          overflow: hidden;
          border-radius: 4px;
      }

      .vote-percentage-indicator {
          height: 100%;
          transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
          position: relative;
      }

      .vote-percentage-indicator::after {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: linear-gradient(90deg, rgba(255, 255, 255, 0.2), transparent);
          animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
          0% {
              transform: translateX(-100%);
          }

          100% {
              transform: translateX(100%);
          }
      }

      /* Enhanced Feedback Message */
      .feedback-message {
          position: absolute;
          bottom: -30px;
          left: 50%;
          transform: translateX(-50%);
          background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));
          color: white;
          padding: 8px 16px;
          border-radius: 9999px;
          font-size: 0.85rem;
          opacity: 0;
          transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          z-index: 20;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          backdrop-filter: blur(4px);
      }

      .show-message {
          bottom: 20px;
          opacity: 1;
          transform: translateX(-50%) translateY(-10px);
      }

      /* Enhanced Ripple Effect */
      .ripple {
          position: absolute;
          background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0) 70%);
          border-radius: 50%;
          transform: scale(0);
          animation: ripple 0.8s cubic-bezier(0.4, 0, 0.2, 1);
          pointer-events: none;
      }

      @keyframes ripple {
          to {
              transform: scale(4);
              opacity: 0;
          }
      }

      /* Enhanced Upcoming Feature Styles */
      .upcoming-feature {
          opacity: 0.9;
          position: relative;
          background: linear-gradient(145deg, #f8fafc, #f1f5f9);
      }

      .dark .upcoming-feature {
          background: linear-gradient(145deg, #1f2937, #111827);
      }

      .upcoming-feature::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: linear-gradient(45deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
          z-index: 1;
      }

      .upcoming-badge {
          position: absolute;
          top: 12px;
          right: 12px;
          background: linear-gradient(135deg, #8B5CF6, #6D28D9);
          color: white;
          padding: 6px 12px;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 600;
          z-index: 2;
          letter-spacing: 0.5px;
          box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
          animation: pulse 2s infinite;
      }

      /* Enhanced Section Divider */
      .section-divider {
          position: relative;
          margin: 3rem 0 4rem;
          text-align: center;
      }

      .section-divider::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 0;
          right: 0;
          height: 2px;
          background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
          z-index: 0;
      }

      .section-divider-text {
          position: relative;
          display: inline-block;
          padding: 0 1.5rem;
          background: white;
          z-index: 1;
          font-weight: 600;
          font-size: 0.875rem;
          letter-spacing: 0.05em;
          color: #6b7280;
          border-radius: 9999px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .dark .section-divider::before {
          background: linear-gradient(90deg, transparent, #4b5563, transparent);
      }

      .dark .section-divider-text {
          background: #1f2937;
          color: #9ca3af;
      }

      /* Enhanced Animations */
      @keyframes float {

          0%,
          100% {
              transform: translateY(0);
          }

          50% {
              transform: translateY(-8px);
          }
      }

      @keyframes pulse {
          0% {
              transform: scale(1);
          }

          50% {
              transform: scale(1.05);
          }

          100% {
              transform: scale(1);
          }
      }

      @keyframes countPop {
          0% {
              transform: scale(1);
          }

          50% {
              transform: scale(1.4);
          }

          100% {
              transform: scale(1);
          }
      }

      /* Enhanced Feature Highlights */
      .feature-highlight {
          font-weight: 500;
          background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0));
          padding: 8px 12px;
          border-radius: 8px;
          display: inline-block;
          margin-bottom: 8px;
          transition: all 0.3s ease;
          border: 1px solid rgba(59, 130, 246, 0.1);
      }

      .feature-highlight:hover {
          background: linear-gradient(90deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05));
          transform: translateX(4px);
      }

      /* Enhanced Try it out Button */
      .try-button {
          background: linear-gradient(135deg, #3b82f6, #2563eb);
          color: white;
          padding: 10px 20px;
          border-radius: 9999px;
          font-weight: 600;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      }

      .try-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 16px rgba(37, 99, 235, 0.3);
      }

      .try-button:active {
          transform: translateY(0);
      }

      /* Loading Animation */
      .loading-skeleton {
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: loading 1.5s infinite;
      }

      .dark .loading-skeleton {
          background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
      }

      @keyframes loading {
          0% {
              background-position: 200% 0;
          }

          100% {
              background-position: -200% 0;
          }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
          .feature-card {
              margin-bottom: 1.5rem;
          }

          .feature-image {
              height: 160px;
          }

          .feature-badge {
              padding: 6px 12px;
              font-size: 0.7rem;
          }
      }
  </style>
{% endblock %}
{% block content %}
  <div class="container mx-auto px-4 py-12">
    <div class="mb-16 text-center">
      <h1 class="text-5xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600">
        Community Features
      </h1>
      <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto text-lg">
        Discover the latest features created by our community members. Try them out and provide feedback!
      </p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Get a Grade Feature Card -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card">
        <div class="absolute top-0 right-0 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10">NEW</div>
        <img src="{% static 'images/features/grade_feature.jpg' %}"
             alt="Get a Grade feature"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Get a Grade</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="https://github.com/GautamSharmaaa"
    class="text-blue-600 dark:text-blue-400 hover:underline">@GautamSharmaaa</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Submit links to your projects, articles, or educational content for peer grading and feedback.
            </p>
            <div class="mb-6 space-y-2">
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Academic grading scale (A to F)
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Detailed feedback for grades below an A
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Track average grades and improvement over time
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <a href="{% url 'gradeable_link_list' %}"
                 class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-transform duration-200">
                <i class="fas fa-external-link-alt mr-2"></i>Try it out
              </a>
              <div class="flex space-x-3">
                <button class="thumbs-up thumbs-button flex items-center space-x-2 px-3 py-2 border rounded-lg hover:bg-green-50 dark:hover:bg-green-900 hover:border-green-400 transition-all"
                        data-feature-id="grade-link">
                  <i class="fas fa-thumbs-up"></i>
                  <span class="count count-bubble text-sm font-medium">0</span>
                </button>
                <button class="thumbs-down thumbs-button flex items-center space-x-2 px-3 py-2 border rounded-lg hover:bg-red-50 dark:hover:bg-red-900 hover:border-red-400 transition-all"
                        data-feature-id="grade-link">
                  <i class="fas fa-thumbs-down"></i>
                  <span class="count count-bubble text-sm font-medium">0</span>
                </button>
              </div>
            </div>
            <div class="votes-summary mt-3 text-center">
              <span class="total-votes">0</span> votes
            </div>
          </div>
        </div>
        <!-- Voting percentage bar -->
        <div class="vote-percentage-bar">
          <div class="vote-percentage-indicator upvote-indicator" style="width: 50%"></div>
          <div class="vote-percentage-indicator downvote-indicator"
               style="width: 50%"></div>
        </div>
        <!-- Feedback message -->
        <div class="feedback-message">Thanks for your feedback!</div>
      </div>
      <!-- Add more feature cards here -->
    </div>
    <!-- Upcoming Features Section -->
    <div class="section-divider mt-16 mb-12">
      <span class="section-divider-text text-gray-500 dark:text-gray-400">UPCOMING FEATURES</span>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- AI Study Assistant - Upcoming -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card upcoming-feature float">
        <div class="upcoming-badge">COMING SOON</div>
        <div class="eta-badge">ETA: July 2024</div>
        <img src="{% static 'images/features/ai_assistant.jpg' %}"
             alt="AI Study Assistant feature"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">AI Study Assistant</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline">@TeamAI</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Personalized AI assistant that adapts to your learning style and helps you study more effectively.
            </p>
            <div class="mb-6 space-y-2">
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Personalized study plans
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Intelligent question answering
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Knowledge gap identification
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <button disabled
                      class="inline-block bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed opacity-70">
                <i class="fas fa-clock mr-2"></i>Coming Soon
              </button>
              <div class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-3 py-1 rounded-full">
                In Development
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Study Group Matching - Upcoming -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card upcoming-feature float">
        <div class="upcoming-badge">COMING SOON</div>
        <div class="eta-badge">ETA: August 2024</div>
        <img src="{% static 'images/features/study_groups.jpg' %}"
             alt="Study Group Matching feature"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Study Group Matching</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline">@CommunityTeam</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Find perfect study partners based on your learning goals, schedule, and study habits.
            </p>
            <div class="mb-6 space-y-2">
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Smart matching algorithm
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Built-in scheduling tools
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Progress tracking for groups
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <button disabled
                      class="inline-block bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed opacity-70">
                <i class="fas fa-clock mr-2"></i>Coming Soon
              </button>
              <div class="bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs px-3 py-1 rounded-full">
                In Planning
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% csrf_token %}
{% endblock %}
{% block extra_js %}
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const thumbsButtons = document.querySelectorAll('.thumbs-up, .thumbs-down');
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

          // Add ripple effect to buttons
          function createRipple(event) {
              const button = event.currentTarget;

              const circle = document.createElement('span');
              circle.classList.add('ripple');

              const diameter = Math.max(button.clientWidth, button.clientHeight);
              const radius = diameter / 2;

              circle.style.width = circle.style.height = `${diameter}px`;

              const rect = button.getBoundingClientRect();
              const x = event.clientX - rect.left - radius;
              const y = event.clientY - rect.top - radius;

              circle.style.left = `${x}px`;
              circle.style.top = `${y}px`;

              const ripple = button.getElementsByClassName('ripple')[0];
              if (ripple) {
                  ripple.remove();
              }

              button.appendChild(circle);
          }

          // Update voting percentage bar
          function updateVotePercentages(featureCard, upPercentage, downPercentage) {
              const upIndicator = featureCard.querySelector('.upvote-indicator');
              const downIndicator = featureCard.querySelector('.downvote-indicator');
              const totalVotesEl = featureCard.querySelector('.total-votes');

              if (upIndicator && downIndicator) {
                  upIndicator.style.width = `${upPercentage}%`;
                  downIndicator.style.width = `${downPercentage}%`;
              }

              if (totalVotesEl) {
                  const totalVotes = parseInt(featureCard.querySelector('.thumbs-up .count').textContent) +
                      parseInt(featureCard.querySelector('.thumbs-down .count').textContent);
                  totalVotesEl.textContent = totalVotes;
              }
          }

          // Show feedback message
          function showFeedbackMessage(featureCard, message) {
              const feedbackEl = featureCard.querySelector('.feedback-message');
              if (feedbackEl) {
                  feedbackEl.textContent = message;
                  feedbackEl.classList.add('show-message');

                  setTimeout(() => {
                      feedbackEl.classList.remove('show-message');
                  }, 3000);
              }
          }

          thumbsButtons.forEach(button => {
              button.addEventListener('mousedown', createRipple);

              button.addEventListener('click', async function() {
                  const featureId = this.getAttribute('data-feature-id');
                  const isUpvote = this.classList.contains('thumbs-up');
                  const featureCard = this.closest('.feature-card');

                  // Button animation on click
                  this.classList.add('scale-95');
                  setTimeout(() => {
                      this.classList.remove('scale-95');
                  }, 100);

                  try {
                      const formData = new FormData();
                      formData.append('feature_id', featureId);
                      formData.append('vote', isUpvote ? 'up' : 'down');

                      const response = await fetch('{% url "feature_vote" %}', {
                          method: 'POST',
                          body: formData,
                          headers: {
                              'X-CSRFToken': csrfToken
                          }
                      });

                      if (!response.ok) throw new Error('Network response was not ok');
                      const data = await response.json();

                      // Show feedback message
                      showFeedbackMessage(featureCard, data.message || 'Thanks for your feedback!');

                      // Update the counts with animation
                      const upButton = featureCard.querySelector('.thumbs-up');
                      const downButton = featureCard.querySelector('.thumbs-down');

                      if (upButton) {
                          const countElement = upButton.querySelector('.count');
                          countElement.classList.add('count-change');
                          countElement.textContent = data.up_count;
                          setTimeout(() => {
                              countElement.classList.remove('count-change');
                          }, 500);
                      }

                      if (downButton) {
                          const countElement = downButton.querySelector('.count');
                          countElement.classList.add('count-change');
                          countElement.textContent = data.down_count;
                          setTimeout(() => {
                              countElement.classList.remove('count-change');
                          }, 500);
                      }

                      // Update vote percentages
                      updateVotePercentages(featureCard, data.up_percentage || 0, data.down_percentage || 0);

                      // Disable buttons and highlight selected only if this is a new vote, not if they're changing their vote
                      if (data.message !== "Vote changed" && data.message !== "You've already cast this vote") {
                          const parentFeedback = featureCard.querySelector('.flex.space-x-3');
                          parentFeedback.querySelectorAll('button').forEach(btn => {
                              btn.disabled = true;
                              btn.classList.add('opacity-70');
                          });
                      }

                      // Highlight the selected button
                      const parentFeedback = featureCard.querySelector('.flex.space-x-3');
                      parentFeedback.querySelectorAll('button').forEach(btn => {
                          btn.classList.remove('selected');
                      });

                      this.classList.remove('opacity-70');
                      this.classList.add('selected');

                      // Store the vote in localStorage
                      localStorage.setItem(`feature-vote-${featureId}`, isUpvote ? 'up' : 'down');

                  } catch (error) {
                      console.error('Error voting on feature:', error);
                      // Enhanced error handling with specific messages
                      if (error.message.includes('Network')) {
                          showFeedbackMessage(featureCard, "Network error. Please check your connection.");
                      } else if (error.message.includes('401') || error.message.includes('403')) {
                          showFeedbackMessage(featureCard, "Please log in to vote on features.");
                      } else {
                          showFeedbackMessage(featureCard, "Error recording your vote. Please try again.");
                      }
                  }
              });
          });

          // Check for existing votes in localStorage and update UI
          thumbsButtons.forEach(button => {
              const featureId = button.getAttribute('data-feature-id');
              const storedVote = localStorage.getItem(`feature-vote-${featureId}`);

              if (storedVote) {
                  const featureCard = button.closest('.feature-card');
                  const parentFeedback = featureCard.querySelector('.flex.space-x-3');

                  if ((storedVote === 'up' && button.classList.contains('thumbs-up')) ||
                      (storedVote === 'down' && button.classList.contains('thumbs-down'))) {
                      button.classList.add('selected');
                  }
              }
          });

          // Check for reduced motion preference
          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

          // Animate feature cards on scroll
          const observerOptions = {
              threshold: 0.1,
              rootMargin: '0px 0px 50px 0px'
          };

          const observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      entry.target.style.opacity = '1';
                      entry.target.style.transform = 'translateY(0)';
                      entry.target.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                      observer.unobserve(entry.target);
                  }
              });
          }, observerOptions);

          document.querySelectorAll('.feature-card').forEach(card => {
              card.style.opacity = '0';
              card.style.transform = 'translateY(20px)';
              card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
              observer.observe(card);

              // Add hover effect to feature highlights
              const highlights = card.querySelectorAll('.feature-highlight');
              highlights.forEach(highlight => {
                  highlight.addEventListener('mouseenter', () => {
                      highlight.style.transform = 'translateX(4px)';
                  });
                  highlight.addEventListener('mouseleave', () => {
                      highlight.style.transform = 'translateX(0)';
                  });
              });
          });

          // Fetch initial vote counts
          async function fetchVoteCounts() {
              const features = document.querySelectorAll('.feature-card');
              if (!features.length) return;

              // Collect all feature IDs
              const featureIds = Array.from(features)
                  .map(feature => feature.dataset.featureId)
                  .filter(id => id); // Remove any undefined/null values

              if (!featureIds.length) return;

              try {
                  const response = await fetch(`/api/feature-vote-count?feature_ids=${featureIds.join(',')}`);
                  if (!response.ok) {
                      throw new Error('Network response was not ok');
                  }
                  const data = await response.json();

                  // Update UI for each feature
                  features.forEach(feature => {
                      const featureId = feature.dataset.featureId;
                      if (!featureId || !data[featureId]) return;

                      const featureData = data[featureId];
                      const upCount = feature.querySelector('.up-count');
                      const downCount = feature.querySelector('.down-count');
                      const upPercentage = feature.querySelector('.up-percentage');
                      const downPercentage = feature.querySelector('.down-percentage');

                      if (upCount) upCount.textContent = featureData.up_count;
                      if (downCount) downCount.textContent = featureData.down_count;
                      if (upPercentage) upPercentage.style.width = `${featureData.up_percentage}%`;
                      if (downPercentage) downPercentage.style.width = `${featureData.down_percentage}%`;

                      // Check localStorage for existing votes
                      const existingVote = localStorage.getItem(`feature_vote_${featureId}`);
                      if (existingVote) {
                          const upButton = feature.querySelector('.vote-up');
                          const downButton = feature.querySelector('.vote-down');
                          if (existingVote === 'up' && upButton) {
                              upButton.classList.add('voted');
                          } else if (existingVote === 'down' && downButton) {
                              downButton.classList.add('voted');
                          }
                      }
                  });
              } catch (error) {
                  console.error('Error fetching vote counts:', error);
              }
          }

          // Initialize vote counts once
          fetchVoteCounts();

          // Add smooth scroll behavior
          document.querySelectorAll('a[href^="#"]').forEach(anchor => {
              anchor.addEventListener('click', function(e) {
                  e.preventDefault();
                  const target = document.querySelector(this.getAttribute('href'));
                  if (target) {
                      target.scrollIntoView({
                          behavior: 'smooth',
                          block: 'start'
                      });
                  }
              });
          });
      });
  </script>
{% endblock %}
