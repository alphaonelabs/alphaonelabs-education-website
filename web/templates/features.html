{% extends "base.html" %}

{% load static %}

{% block title %}Features - AlphaOne Labs{% endblock %}
{% block extra_head %}
  <style>
      /* Enhanced Card Layout */
      .feature-card {
          transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          border: 1px solid #e2e8f0;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
          transform: translateY(0);
          overflow: hidden;
          position: relative;
          background: linear-gradient(145deg, #ffffff, #f8fafc);
          height: 100%;
          display: flex;
          flex-direction: column;
          border-radius: 1rem;
      }

      .feature-card .p-6 {
          flex: 1;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          padding: 1.5rem;
      }

      /* Improved Content Spacing */
      .feature-card h3 {
          margin-bottom: 0.75rem;
          line-height: 1.4;
          font-size: 1.5rem;
          font-weight: 600;
          color: #1e293b;
      }

      .dark .feature-card h3 {
          color: #f8fafc;
      }

      .feature-card .text-sm {
          line-height: 1.5;
          font-size: 0.875rem;
      }

      .feature-card p {
          margin-bottom: 1.5rem;
          line-height: 1.6;
          color: #475569;
      }

      .dark .feature-card p {
          color: #cbd5e1;
      }

      /* Enhanced Feature Highlights */
      .feature-highlight {
          margin-bottom: 0.75rem;
          padding: 0.75rem 1rem;
          border-radius: 0.75rem;
          display: flex;
          align-items: center;
          gap: 0.75rem;
          transition: all 0.3s ease;
          background: #f8fafc;
          border: 1px solid #e2e8f0;
      }

      .dark .feature-highlight {
          background: #1e293b;
          border-color: #334155;
      }

      .feature-highlight i {
          font-size: 1.25rem;
          flex-shrink: 0;
          color: #10b981;
      }

      /* Improved Button Layout */
      .feature-card .flex.justify-between {
          margin-top: auto;
          padding-top: 1.5rem;
          border-top: 1px solid #e2e8f0;
          display: flex;
          align-items: center;
          gap: 1rem;
      }

      .dark .feature-card .flex.justify-between {
          border-top-color: #334155;
      }

      /* Enhanced Voting Buttons */
      .thumbs-button {
          min-width: 90px;
          height: 36px;
          justify-content: center;
          padding: 0.5rem 1rem;
          border-radius: 0.5rem;
          font-weight: 500;
          font-size: 0.875rem;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          border: 1px solid #e2e8f0;
          background: #ffffff;
          color: #475569;
          display: inline-flex;
          align-items: center;
          gap: 0.375rem;
      }

      .dark .thumbs-button {
          background: #1e293b;
          border-color: #334155;
          color: #cbd5e1;
      }

      .thumbs-button i {
          font-size: 1rem;
          margin-right: 0.25rem;
      }

      .thumbs-button .count {
          font-size: 0.875rem;
          font-weight: 600;
          min-width: 1.25rem;
          text-align: center;
      }

      .thumbs-button:hover {
          transform: translateY(-1px);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .thumbs-button:active {
          transform: translateY(0);
      }

      .thumbs-up.selected {
          background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
          border-color: #10b981;
          color: #10b981;
          transform: scale(1.02);
      }

      .thumbs-down.selected {
          background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
          border-color: #ef4444;
          color: #ef4444;
          transform: scale(1.02);
      }

      /* Improved Vote Count Display */
      .votes-summary {
          text-align: center;
          margin-top: 1rem;
          padding: 0.75rem;
          background: #f8fafc;
          border-radius: 0.75rem;
          font-size: 0.875rem;
          color: #64748b;
          border: 1px solid #e2e8f0;
      }

      .dark .votes-summary {
          background: #1e293b;
          color: #94a3b8;
          border-color: #334155;
      }

      /* Enhanced Progress Bar */
      .vote-percentage-bar {
          height: 8px;
          background: #f1f5f9;
          border-radius: 4px;
          overflow: hidden;
          margin-top: 1rem;
          position: relative;
      }

      .dark .vote-percentage-bar {
          background: #334155;
      }

      .vote-percentage-indicator {
          height: 100%;
          transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
          position: absolute;
          top: 0;
      }

      .upvote-indicator {
          left: 0;
          background: linear-gradient(90deg, #10b981, #059669);
      }

      .downvote-indicator {
          right: 0;
          background: linear-gradient(90deg, #ef4444, #dc2626);
      }

      /* Enhanced Badge Styles */
      .feature-badge,
      .upcoming-badge {
          padding: 0.5rem 1rem;
          font-size: 0.75rem;
          font-weight: 600;
          letter-spacing: 0.025em;
          border-radius: 9999px;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          position: absolute;
          top: 1rem;
          right: 1rem;
          z-index: 10;
      }

      .feature-badge {
          background: linear-gradient(135deg, #3b82f6, #2563eb);
          color: white;
      }

      .upcoming-badge {
          background: linear-gradient(135deg, #8b5cf6, #6d28d9);
          color: white;
      }

      /* Enhanced Image Styles */
      .feature-image {
          height: 200px;
          width: 100%;
          object-fit: cover;
          transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
          border-bottom: 1px solid #e2e8f0;
          filter: brightness(0.95);
      }

      .dark .feature-image {
          border-bottom-color: #334155;
      }

      .feature-card:hover .feature-image {
          transform: scale(1.08);
          filter: brightness(1);
      }

      /* Enhanced Feedback Message */
      .feedback-message {
          position: fixed;
          bottom: 2rem;
          left: 50%;
          transform: translateX(-50%) translateY(100px);
          background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.8));
          color: white;
          padding: 0.875rem 1.75rem;
          border-radius: 9999px;
          font-size: 0.875rem;
          opacity: 0;
          transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
          z-index: 50;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          backdrop-filter: blur(4px);
          max-width: 90%;
          text-align: center;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }

      .feedback-message.show-message {
          transform: translateX(-50%) translateY(0);
          opacity: 1;
      }

      /* Enhanced Section Divider */
      .section-divider {
          position: relative;
          margin: 4rem 0;
          text-align: center;
      }

      .section-divider::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 0;
          right: 0;
          height: 1px;
          background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
      }

      .dark .section-divider::before {
          background: linear-gradient(90deg, transparent, #4b5563, transparent);
      }

      .section-divider-text {
          position: relative;
          display: inline-block;
          padding: 0.5rem 1.5rem;
          background: white;
          border-radius: 9999px;
          font-size: 0.875rem;
          font-weight: 600;
          letter-spacing: 0.05em;
          color: #6b7280;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .dark .section-divider-text {
          background: #1f2937;
          color: #9ca3af;
      }

      /* Enhanced Try Button */
      .try-button {
          height: 42px;
          padding: 0.75rem 2rem;
          font-weight: 600;
          font-size: 1rem;
          letter-spacing: 0.025em;
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          background: linear-gradient(135deg, #3b82f6, #2563eb);
          color: white;
          border-radius: 0.75rem;
          box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
          min-width: 160px;
          justify-content: center;
          margin-left: auto;
      }

      .try-button i {
          font-size: 1.125rem;
          transition: transform 0.3s ease;
      }

      /* Enhanced Mobile Responsiveness */
      @media (max-width: 768px) {
          .feature-card {
              margin-bottom: 1.5rem;
          }

          .feature-image {
              height: 180px;
          }

          .feature-card .flex.justify-between {
              flex-wrap: wrap;
              gap: 0.75rem;
          }

          .thumbs-button {
              min-width: 80px;
              height: 32px;
              padding: 0.375rem 0.875rem;
              font-size: 0.8125rem;
          }

          .thumbs-button i {
              font-size: 0.875rem;
          }

          .try-button {
              width: 100%;
              height: 38px;
              padding: 0.625rem 1.5rem;
              font-size: 0.9375rem;
              min-width: unset;
              margin-left: 0;
          }

          .try-button i {
              font-size: 1rem;
          }

          .feedback-message {
              bottom: 1rem;
              padding: 0.625rem 1.25rem;
              font-size: 0.75rem;
          }

          .section-divider {
              margin: 3rem 0;
          }

          .section-divider-text {
              padding: 0.4rem 1rem;
              font-size: 0.75rem;
          }
      }

      /* Enhanced Focus States */
      :focus-visible {
          outline: 2px solid #3b82f6;
          outline-offset: 2px;
      }

      .dark :focus-visible {
          outline-color: #60a5fa;
      }

      /* Enhanced Reduced Motion */
      @media (prefers-reduced-motion: reduce) {
          * {
              animation-duration: 0.01ms !important;
              animation-iteration-count: 1 !important;
              transition-duration: 0.01ms !important;
              scroll-behavior: auto !important;
          }
      }

      /* Enhanced Button States */
      .thumbs-button:hover {
          transform: translateY(-1px);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .thumbs-button:active {
          transform: translateY(0);
      }

      .thumbs-button:hover i {
          transform: translateX(2px);
      }

      .try-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
      }

      .try-button:active {
          transform: translateY(0);
      }

      .try-button:hover i {
          transform: translateX(2px);
      }

      /* Enhanced Button Group */
      .flex.space-x-3 {
          gap: 0.5rem;
          display: flex;
          align-items: center;
      }

      /* Enhanced Button Loading State */
      .thumbs-button:disabled,
      .try-button:disabled {
          opacity: 0.7;
          cursor: not-allowed;
          transform: none;
          box-shadow: none;
      }

      /* Enhanced Button Ripple Effect */
      .ripple {
          position: absolute;
          background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0) 70%);
          border-radius: 50%;
          transform: scale(0);
          animation: ripple 0.8s cubic-bezier(0.4, 0, 0.2, 1);
          pointer-events: none;
      }

      @keyframes ripple {
          to {
              transform: scale(4);
              opacity: 0;
          }
      }
  </style>
{% endblock %}
{% block content %}
  <div class="container mx-auto px-4 py-12" role="main">
    <div class="mb-16 text-center">
      <h1 class="text-5xl font-bold mb-6 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600">
        Community Features
      </h1>
      <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto text-lg">
        Discover the latest features created by our community members. Try them out and provide feedback!
      </p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
         role="list">
      <!-- Get a Grade Feature Card -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card"
           role="listitem">
        <div class="absolute top-0 right-0 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10"
             role="status"
             aria-label="New feature">NEW</div>
        <img src="{% static 'images/features/grade_feature.jpg' %}"
             alt="Get a Grade feature preview"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'"
             loading="lazy" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Get a Grade</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="https://github.com/GautamSharmaaa"
    class="text-blue-600 dark:text-blue-400 hover:underline"
    target="_blank"
    rel="noopener noreferrer"
    aria-label="View @GautamSharmaaa's GitHub profile">@GautamSharmaaa</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Submit links to your projects, articles, or educational content for peer grading and feedback.
            </p>
            <div class="mb-6 space-y-2" role="list">
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Academic grading scale (A to F)
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Detailed feedback for grades below an A
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Track average grades and improvement over time
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <a href="{% url 'gradeable_link_list' %}"
                 class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-transform duration-200"
                 aria-label="Try out the Get a Grade feature">
                <i class="fas fa-external-link-alt mr-2" aria-hidden="true"></i>Try it out
              </a>
              <div class="flex space-x-3" role="group" aria-label="Vote on this feature">
                <button class="thumbs-up thumbs-button flex items-center space-x-2 px-3 py-2 border rounded-lg hover:bg-green-50 dark:hover:bg-green-900 hover:border-green-400 transition-all"
                        data-feature-id="grade-link"
                        aria-label="Vote thumbs up for Get a Grade feature"
                        aria-pressed="false">
                  <i class="fas fa-thumbs-up" aria-hidden="true"></i>
                  <span class="count count-bubble text-sm font-medium">0</span>
                </button>
                <button class="thumbs-down thumbs-button flex items-center space-x-2 px-3 py-2 border rounded-lg hover:bg-red-50 dark:hover:bg-red-900 hover:border-red-400 transition-all"
                        data-feature-id="grade-link"
                        aria-label="Vote thumbs down for Get a Grade feature"
                        aria-pressed="false">
                  <i class="fas fa-thumbs-down" aria-hidden="true"></i>
                  <span class="count count-bubble text-sm font-medium">0</span>
                </button>
              </div>
            </div>
            <div class="votes-summary mt-3 text-center" aria-live="polite">
              <span class="total-votes">0</span> votes
            </div>
          </div>
        </div>
        <!-- Voting percentage bar -->
        <div class="vote-percentage-bar"
             role="progressbar"
             aria-valuenow="50"
             aria-valuemin="0"
             aria-valuemax="100">
          <div class="vote-percentage-indicator upvote-indicator" style="width: 50%"></div>
          <div class="vote-percentage-indicator downvote-indicator"
               style="width: 50%"></div>
        </div>
        <!-- Feedback message -->
        <div class="feedback-message" role="alert" aria-live="polite">Thanks for your feedback!</div>
      </div>
      <!-- Add more feature cards here -->
    </div>
    <!-- Upcoming Features Section -->
    <div class="section-divider mt-16 mb-12">
      <span class="section-divider-text text-gray-500 dark:text-gray-400"
            role="heading"
            aria-level="2">UPCOMING FEATURES</span>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
         role="list">
      <!-- AI Study Assistant - Upcoming -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card upcoming-feature float"
           role="listitem">
        <div class="upcoming-badge" role="status" aria-label="Coming soon">COMING SOON</div>
        <div class="eta-badge"
             role="status"
             aria-label="Estimated release date: July 2024">ETA: July 2024</div>
        <img src="{% static 'images/features/ai_assistant.jpg' %}"
             alt="AI Study Assistant feature preview"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'"
             loading="lazy" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">AI Study Assistant</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="#"
    class="text-blue-600 dark:text-blue-400 hover:underline"
    target="_blank"
    rel="noopener noreferrer"
    aria-label="View @TeamAI's profile">@TeamAI</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Personalized AI assistant that adapts to your learning style and helps you study more effectively.
            </p>
            <div class="mb-6 space-y-2" role="list">
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Personalized study plans
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Intelligent question answering
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Knowledge gap identification
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <button disabled
                      class="inline-block bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed opacity-70"
                      aria-label="AI Study Assistant feature coming soon">
                <i class="fas fa-clock mr-2" aria-hidden="true"></i>Coming Soon
              </button>
              <div class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-3 py-1 rounded-full"
                   role="status">In Development</div>
            </div>
          </div>
        </div>
      </div>
      <!-- Study Group Matching - Upcoming -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card upcoming-feature float"
           role="listitem">
        <div class="upcoming-badge" role="status" aria-label="Coming soon">COMING SOON</div>
        <div class="eta-badge"
             role="status"
             aria-label="Estimated release date: August 2024">ETA: August 2024</div>
        <img src="{% static 'images/features/study_groups.jpg' %}"
             alt="Study Group Matching feature preview"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'"
             loading="lazy" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Study Group Matching</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="#"
    class="text-blue-600 dark:text-blue-400 hover:underline"
    target="_blank"
    rel="noopener noreferrer"
    aria-label="View @CommunityTeam's profile">@CommunityTeam</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Find perfect study partners based on your learning goals, schedule, and study habits.
            </p>
            <div class="mb-6 space-y-2" role="list">
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Smart matching algorithm
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Built-in scheduling tools
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200"
                   role="listitem">
                <i class="fas fa-check-circle text-green-500 mr-2" aria-hidden="true"></i> Progress tracking for groups
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <button disabled
                      class="inline-block bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed opacity-70"
                      aria-label="Study Group Matching feature coming soon">
                <i class="fas fa-clock mr-2" aria-hidden="true"></i>Coming Soon
              </button>
              <div class="bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs px-3 py-1 rounded-full"
                   role="status">In Planning</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% csrf_token %}
{% endblock %}
{% block extra_js %}
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          // Cache DOM elements
          const thumbsButtons = document.querySelectorAll('.thumbs-up, .thumbs-down');
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
          const featureCards = document.querySelectorAll('.feature-card');

          // Performance optimization: Use ResizeObserver for dynamic adjustments
          const resizeObserver = new ResizeObserver(entries => {
              entries.forEach(entry => {
                  const card = entry.target;
                  const content = card.querySelector('.p-6');
                  if (content) {
                      const height = content.offsetHeight;
                      card.style.setProperty('--content-height', `${height}px`);
                  }
              });
          });

          featureCards.forEach(card => resizeObserver.observe(card));

          // Debounce function for performance
          function debounce(func, wait) {
              let timeout;
              return function executedFunction(...args) {
                  const later = () => {
                      clearTimeout(timeout);
                      func(...args);
                  };
                  clearTimeout(timeout);
                  timeout = setTimeout(later, wait);
              };
          }

          // Enhanced ripple effect with performance optimization
          function createRipple(event) {
              const button = event.currentTarget;
              const rect = button.getBoundingClientRect();
              const diameter = Math.max(rect.width, rect.height);
              const radius = diameter / 2;

              const circle = document.createElement('span');
              circle.classList.add('ripple');
              circle.style.width = circle.style.height = `${diameter}px`;
              circle.style.left = `${event.clientX - rect.left - radius}px`;
              circle.style.top = `${event.clientY - rect.top - radius}px`;

              const ripple = button.getElementsByClassName('ripple')[0];
              if (ripple) ripple.remove();

              button.appendChild(circle);

              // Clean up ripple element after animation
              circle.addEventListener('animationend', () => {
                  circle.remove();
              });
          }

          // Optimized vote percentage update with RAF
          function updateVotePercentages(featureCard, upPercentage, downPercentage) {
              const upIndicator = featureCard.querySelector('.upvote-indicator');
              const downIndicator = featureCard.querySelector('.downvote-indicator');
              const totalVotesEl = featureCard.querySelector('.total-votes');

              if (upIndicator && downIndicator) {
                  requestAnimationFrame(() => {
                      upIndicator.style.width = `${upPercentage}%`;
                      downIndicator.style.width = `${downPercentage}%`;
                  });
              }

              if (totalVotesEl) {
                  const upCount = parseInt(featureCard.querySelector('.thumbs-up .count').textContent) || 0;
                  const downCount = parseInt(featureCard.querySelector('.thumbs-down .count').textContent) || 0;
                  totalVotesEl.textContent = upCount + downCount;
              }
          }

          // Enhanced feedback message with animation and queue
          const feedbackQueue = [];
          let isShowingFeedback = false;

          function showFeedbackMessage(featureCard, message) {
              feedbackQueue.push({
                  featureCard,
                  message
              });
              if (!isShowingFeedback) {
                  processFeedbackQueue();
              }
          }

          function processFeedbackQueue() {
              if (feedbackQueue.length === 0) {
                  isShowingFeedback = false;
                  return;
              }

              isShowingFeedback = true;
              const {
                  featureCard,
                  message
              } = feedbackQueue.shift();
              const feedbackEl = featureCard.querySelector('.feedback-message');

              if (!feedbackEl) {
                  processFeedbackQueue();
                  return;
              }

              feedbackEl.textContent = message;
              feedbackEl.classList.add('show-message');

              requestAnimationFrame(() => {
                  setTimeout(() => {
                      feedbackEl.classList.remove('show-message');
                      processFeedbackQueue();
                  }, 3000);
              });
          }

          // Optimized vote handling with error recovery
          thumbsButtons.forEach(button => {
              button.addEventListener('mousedown', createRipple);

              button.addEventListener('click', async function() {
                  const featureId = this.getAttribute('data-feature-id');
                  const isUpvote = this.classList.contains('thumbs-up');
                  const featureCard = this.closest('.feature-card');

                  // Prevent double-clicking and add loading state
                  if (this.disabled) return;
                  this.disabled = true;
                  this.classList.add('opacity-70');

                  // Visual feedback
                  this.classList.add('scale-95');
                  setTimeout(() => this.classList.remove('scale-95'), 100);

                  try {
                      const formData = new FormData();
                      formData.append('feature_id', featureId);
                      formData.append('vote', isUpvote ? 'up' : 'down');

                      const response = await fetch('{% url "feature_vote" %}', {
                          method: 'POST',
                          body: formData,
                          headers: {
                              'X-CSRFToken': csrfToken
                          }
                      });

                      if (!response.ok) throw new Error('Network response was not ok');
                      const data = await response.json();

                      // Update UI with animation
                      showFeedbackMessage(featureCard, data.message || 'Thanks for your feedback!');

                      // Update counts with animation
                      const upButton = featureCard.querySelector('.thumbs-up');
                      const downButton = featureCard.querySelector('.thumbs-down');

                      if (upButton) {
                          const countElement = upButton.querySelector('.count');
                          countElement.classList.add('count-change');
                          countElement.textContent = data.up_count;
                          setTimeout(() => countElement.classList.remove('count-change'), 500);
                      }

                      if (downButton) {
                          const countElement = downButton.querySelector('.count');
                          countElement.classList.add('count-change');
                          countElement.textContent = data.down_count;
                          setTimeout(() => countElement.classList.remove('count-change'), 500);
                      }

                      // Update percentages
                      updateVotePercentages(featureCard, data.up_percentage || 0, data.down_percentage || 0);

                      // Handle button states
                      if (data.message !== "Vote changed" && data.message !== "You've already cast this vote") {
                          const parentFeedback = featureCard.querySelector('.flex.space-x-3');
                          parentFeedback.querySelectorAll('button').forEach(btn => {
                              btn.disabled = true;
                              btn.classList.add('opacity-70');
                          });
                      }

                      // Update selected state
                      const parentFeedback = featureCard.querySelector('.flex.space-x-3');
                      parentFeedback.querySelectorAll('button').forEach(btn => {
                          btn.classList.remove('selected');
                      });

                      this.classList.remove('opacity-70');
                      this.classList.add('selected');

                      // Update ARIA state
                      this.setAttribute('aria-pressed', 'true');

                      // Store vote in localStorage
                      localStorage.setItem(`feature-vote-${featureId}`, isUpvote ? 'up' : 'down');

                  } catch (error) {
                      console.error('Error voting on feature:', error);
                      showFeedbackMessage(featureCard,
                          error.message.includes('Network') ? "Network error. Please check your connection." :
                          error.message.includes('401') || error.message.includes('403') ? "Please log in to vote on features." :
                          "Error recording your vote. Please try again."
                      );
                      // Reset button state on error
                      this.disabled = false;
                      this.classList.remove('opacity-70');
                  }
              });
          });

          // Optimized vote count fetching with retry logic
          const fetchVoteCounts = debounce(async function(retryCount = 0) {
              const features = document.querySelectorAll('.feature-card');
              if (!features.length) return;

              const featureIds = Array.from(features)
                  .map(feature => {
                      const thumbsUpButton = feature.querySelector('.thumbs-up');
                      return thumbsUpButton ? thumbsUpButton.getAttribute('data-feature-id') : null;
                  })
                  .filter(Boolean);

              if (!featureIds.length) return;

              try {
                  const response = await fetch(`/api/feature-vote-count?feature_ids=${featureIds.join(',')}`);
                  if (!response.ok) throw new Error('Network response was not ok');
                  const data = await response.json();

                  // Update UI for each feature
                  features.forEach(feature => {
                      const thumbsUpButton = feature.querySelector('.thumbs-up');
                      const featureId = thumbsUpButton ? thumbsUpButton.getAttribute('data-feature-id') : null;
                      if (!featureId || !data[featureId]) return;

                      const featureData = data[featureId];
                      const upCount = feature.querySelector('.thumbs-up .count');
                      const downCount = feature.querySelector('.thumbs-down .count');

                      if (upCount) upCount.textContent = featureData.up_count;
                      if (downCount) downCount.textContent = featureData.down_count;

                      updateVotePercentages(feature, featureData.up_percentage, featureData.down_percentage);

                      // Check localStorage for existing votes
                      const existingVote = localStorage.getItem(`feature-vote-${featureId}`);
                      if (existingVote) {
                          const upButton = feature.querySelector('.thumbs-up');
                          const downButton = feature.querySelector('.thumbs-down');
                          if (existingVote === 'up' && upButton) {
                              upButton.classList.add('selected');
                              upButton.setAttribute('aria-pressed', 'true');
                          } else if (existingVote === 'down' && downButton) {
                              downButton.classList.add('selected');
                              downButton.setAttribute('aria-pressed', 'true');
                          }
                      }
                  });
              } catch (error) {
                  console.error('Error fetching vote counts:', error);
                  if (retryCount < 3) {
                      setTimeout(() => fetchVoteCounts(retryCount + 1), 1000 * (retryCount + 1));
                  }
              }
          }, 250);

          // Initialize vote counts
          fetchVoteCounts();

          // Optimized scroll animations with IntersectionObserver
          const observerOptions = {
              threshold: 0.1,
              rootMargin: '0px 0px 50px 0px'
          };

          const observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      requestAnimationFrame(() => {
                          entry.target.style.opacity = '1';
                          entry.target.style.transform = 'translateY(0)';
                          entry.target.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                      });
                      observer.unobserve(entry.target);
                  }
              });
          }, observerOptions);

          // Initialize scroll animations
          featureCards.forEach(card => {
              card.style.opacity = '0';
              card.style.transform = 'translateY(20px)';
              card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
              observer.observe(card);

              // Add hover effect to feature highlights
              const highlights = card.querySelectorAll('.feature-highlight');
              highlights.forEach(highlight => {
                  highlight.addEventListener('mouseenter', () => {
                      requestAnimationFrame(() => {
                          highlight.style.transform = 'translateX(4px)';
                      });
                  });
                  highlight.addEventListener('mouseleave', () => {
                      requestAnimationFrame(() => {
                          highlight.style.transform = 'translateX(0)';
                      });
                  });
              });
          });

          // Smooth scroll with performance optimization
          document.querySelectorAll('a[href^="#"]').forEach(anchor => {
              anchor.addEventListener('click', function(e) {
                  e.preventDefault();
                  const target = document.querySelector(this.getAttribute('href'));
                  if (target) {
                      target.scrollIntoView({
                          behavior: 'smooth',
                          block: 'start'
                      });
                  }
              });
          });

          // Clean up observers on page unload
          window.addEventListener('unload', () => {
              resizeObserver.disconnect();
              observer.disconnect();
          });
      });
  </script>
{% endblock %}
