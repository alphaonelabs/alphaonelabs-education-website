{% extends "base.html" %}

{% load static %}

{% block title %}Features - AlphaOne Labs{% endblock %}
{% block extra_head %}
  <style>
      .feature-card {
          transition: all 0.3s ease;
          border: 1px solid #e2e8f0;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
          transform: translateY(0);
          overflow: hidden;
      }

      .feature-card:hover {
          transform: translateY(-8px);
          box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
      }

      .feature-badge {
          position: absolute;
          top: -10px;
          right: -10px;
          animation: pulse 2s infinite;
      }

      .feature-image {
          height: 160px;
          width: 100%;
          object-fit: cover;
          transition: transform 0.5s ease;
          border-bottom: 1px solid #e2e8f0;
      }

      .feature-card:hover .feature-image {
          transform: scale(1.05);
      }

      .thumbs-button {
          transition: all 0.2s ease;
          position: relative;
          overflow: hidden;
      }

      .thumbs-button:before {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          width: 0;
          height: 0;
          background-color: rgba(255, 255, 255, 0.3);
          border-radius: 50%;
          transform: translate(-50%, -50%);
          transition: width 0.4s ease, height 0.4s ease;
      }

      .thumbs-button:active:before {
          width: 200px;
          height: 200px;
      }

      .thumbs-up.selected {
          background-color: rgba(52, 211, 153, 0.2);
          border-color: #10B981;
          color: #10B981;
          transform: scale(1.05);
      }

      .thumbs-down.selected {
          background-color: rgba(248, 113, 113, 0.2);
          border-color: #EF4444;
          color: #EF4444;
          transform: scale(1.05);
      }

      .count-bubble {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease;
      }

      .count-change {
          animation: countPop 0.5s ease;
      }

      @keyframes countPop {
          0% {
              transform: scale(1);
          }

          50% {
              transform: scale(1.3);
          }

          100% {
              transform: scale(1);
          }
      }

      @keyframes pulse {
          0% {
              transform: scale(1);
          }

          50% {
              transform: scale(1.1);
          }

          100% {
              transform: scale(1);
          }
      }

      .feature-highlight {
          font-weight: 500;
          background: linear-gradient(90deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0) 100%);
          padding: 4px 8px;
          border-radius: 4px;
          display: inline-block;
          margin-bottom: 4px;
      }

      .vote-percentage-bar {
          position: absolute;
          bottom: 0;
          left: 0;
          width: 100%;
          height: 6px;
          background: #f3f4f6;
          overflow: hidden;
      }

      .vote-percentage-indicator {
          height: 100%;
          transition: width 0.5s ease;
      }

      .upvote-indicator {
          background-color: #10B981;
      }

      .downvote-indicator {
          background-color: #EF4444;
          right: 0;
          position: absolute;
      }

      .votes-summary {
          display: flex;
          align-items: center;
          justify-content: center;
          margin-top: 8px;
          font-size: 0.85rem;
          color: #6b7280;
      }

      .feedback-message {
          position: absolute;
          bottom: -30px;
          left: 50%;
          transform: translateX(-50%);
          background-color: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 4px 12px;
          border-radius: 4px;
          font-size: 0.8rem;
          opacity: 0;
          transition: all 0.3s ease;
          z-index: 20;
      }

      .show-message {
          bottom: 10px;
          opacity: 1;
      }

      .ripple {
          position: absolute;
          background-color: rgba(255, 255, 255, 0.7);
          border-radius: 50%;
          transform: scale(0);
          animation: ripple 0.6s linear;
          pointer-events: none;
      }

      @keyframes ripple {
          to {
              transform: scale(4);
              opacity: 0;
          }
      }

      .upcoming-feature {
          opacity: 0.8;
          position: relative;
      }

      .upcoming-feature::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.05);
          z-index: 1;
      }

      .upcoming-badge {
          position: absolute;
          top: 10px;
          right: 10px;
          background-color: #8B5CF6;
          color: white;
          padding: 4px 10px;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 600;
          z-index: 2;
          letter-spacing: 0.5px;
      }

      .eta-badge {
          position: absolute;
          bottom: 10px;
          right: 10px;
          background-color: rgba(0, 0, 0, 0.7);
          color: white;
          padding: 2px 8px;
          border-radius: 4px;
          font-size: 0.7rem;
          z-index: 2;
      }

      .section-divider {
          position: relative;
          margin: 2rem 0 3rem;
          text-align: center;
      }

      .section-divider::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 0;
          right: 0;
          height: 1px;
          background: #e5e7eb;
          z-index: 0;
      }

      .section-divider-text {
          position: relative;
          display: inline-block;
          padding: 0 1rem;
          background: white;
          z-index: 1;
          font-weight: 600;
      }

      .dark .section-divider::before {
          background: #4b5563;
      }

      .dark .section-divider-text {
          background: #1f2937;
      }

      @keyframes float {
          0% {
              transform: translateY(0px);
          }

          50% {
              transform: translateY(-5px);
          }

          100% {
              transform: translateY(0px);
          }
      }

      .float {
          animation: float 3s ease-in-out infinite;
      }
  </style>
{% endblock %}
{% block content %}
  <div class="container mx-auto px-4 py-12">
    <div class="mb-16 text-center">
      <h1 class="text-4xl font-bold mb-4">Community Features</h1>
      <p class="text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        Discover the latest features created by our community members. Try them out and provide feedback!
      </p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Get a Grade Feature Card -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card">
        <div class="absolute top-0 right-0 bg-blue-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg z-10">NEW</div>
        <img src="{% static 'images/features/grade_feature.jpg' %}"
             alt="Get a Grade feature"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Get a Grade</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="https://github.com/GautamSharmaaa"
    class="text-blue-600 dark:text-blue-400 hover:underline">@GautamSharmaaa</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Submit links to your projects, articles, or educational content for peer grading and feedback.
            </p>
            <div class="mb-6 space-y-2">
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Academic grading scale (A to F)
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Detailed feedback for grades below an A
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Track average grades and improvement over time
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <a href="{% url 'gradeable_link_list' %}"
                 class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors shadow-md hover:shadow-lg transform hover:-translate-y-1 transition-transform duration-200">
                <i class="fas fa-external-link-alt mr-2"></i>Try it out
              </a>
              <div class="flex space-x-3">
                <button class="thumbs-up thumbs-button flex items-center space-x-2 px-3 py-2 border rounded-lg hover:bg-green-50 dark:hover:bg-green-900 hover:border-green-400 transition-all"
                        data-feature-id="grade-link">
                  <i class="fas fa-thumbs-up"></i>
                  <span class="count count-bubble text-sm font-medium">0</span>
                </button>
                <button class="thumbs-down thumbs-button flex items-center space-x-2 px-3 py-2 border rounded-lg hover:bg-red-50 dark:hover:bg-red-900 hover:border-red-400 transition-all"
                        data-feature-id="grade-link">
                  <i class="fas fa-thumbs-down"></i>
                  <span class="count count-bubble text-sm font-medium">0</span>
                </button>
              </div>
            </div>
            <div class="votes-summary mt-3 text-center">
              <span class="total-votes">0</span> votes
            </div>
          </div>
        </div>
        <!-- Voting percentage bar -->
        <div class="vote-percentage-bar">
          <div class="vote-percentage-indicator upvote-indicator" style="width: 50%"></div>
          <div class="vote-percentage-indicator downvote-indicator"
               style="width: 50%"></div>
        </div>
        <!-- Feedback message -->
        <div class="feedback-message">Thanks for your feedback!</div>
      </div>
      <!-- Add more feature cards here -->
    </div>
    <!-- Upcoming Features Section -->
    <div class="section-divider mt-16 mb-12">
      <span class="section-divider-text text-gray-500 dark:text-gray-400">UPCOMING FEATURES</span>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- AI Study Assistant - Upcoming -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card upcoming-feature float">
        <div class="upcoming-badge">COMING SOON</div>
        <div class="eta-badge">ETA: July 2024</div>
        <img src="{% static 'images/features/ai_assistant.jpg' %}"
             alt="AI Study Assistant feature"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">AI Study Assistant</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline">@TeamAI</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Personalized AI assistant that adapts to your learning style and helps you study more effectively.
            </p>
            <div class="mb-6 space-y-2">
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Personalized study plans
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Intelligent question answering
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Knowledge gap identification
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <button disabled
                      class="inline-block bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed opacity-70">
                <i class="fas fa-clock mr-2"></i>Coming Soon
              </button>
              <div class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-3 py-1 rounded-full">
                In Development
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Study Group Matching - Upcoming -->
      <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden relative feature-card upcoming-feature float">
        <div class="upcoming-badge">COMING SOON</div>
        <div class="eta-badge">ETA: August 2024</div>
        <img src="{% static 'images/features/study_groups.jpg' %}"
             alt="Study Group Matching feature"
             class="feature-image"
             onerror="this.src='{% static 'images/placeholder.jpg' %}'" />
        <div class="p-6">
          <div class="flex justify-between items-start mb-5">
            <h3 class="text-xl font-semibold text-gray-800 dark:text-white">Study Group Matching</h3>
            <span class="text-sm text-gray-500 dark:text-gray-400">by <a href="#" class="text-blue-600 dark:text-blue-400 hover:underline">@CommunityTeam</a></span>
          </div>
          <div>
            <p class="text-gray-700 dark:text-gray-300 mb-5 leading-relaxed">
              Find perfect study partners based on your learning goals, schedule, and study habits.
            </p>
            <div class="mb-6 space-y-2">
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Smart matching algorithm
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Built-in scheduling tools
              </div>
              <div class="feature-highlight text-gray-800 dark:text-gray-200">
                <i class="fas fa-check-circle text-green-500 mr-2"></i> Progress tracking for groups
              </div>
            </div>
            <div class="flex justify-between items-center mt-6">
              <button disabled
                      class="inline-block bg-gray-400 text-white font-medium py-2 px-6 rounded-lg cursor-not-allowed opacity-70">
                <i class="fas fa-clock mr-2"></i>Coming Soon
              </button>
              <div class="bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-xs px-3 py-1 rounded-full">
                In Planning
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% csrf_token %}
{% endblock %}
{% block extra_js %}
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const thumbsButtons = document.querySelectorAll('.thumbs-up, .thumbs-down');
          const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

          // Add ripple effect to buttons
          function createRipple(event) {
              const button = event.currentTarget;

              const circle = document.createElement('span');
              circle.classList.add('ripple');

              const diameter = Math.max(button.clientWidth, button.clientHeight);
              const radius = diameter / 2;

              circle.style.width = circle.style.height = `${diameter}px`;

              const rect = button.getBoundingClientRect();
              const x = event.clientX - rect.left - radius;
              const y = event.clientY - rect.top - radius;

              circle.style.left = `${x}px`;
              circle.style.top = `${y}px`;

              const ripple = button.getElementsByClassName('ripple')[0];
              if (ripple) {
                  ripple.remove();
              }

              button.appendChild(circle);
          }

          // Update voting percentage bar
          function updateVotePercentages(featureCard, upPercentage, downPercentage) {
              const upIndicator = featureCard.querySelector('.upvote-indicator');
              const downIndicator = featureCard.querySelector('.downvote-indicator');
              const totalVotesEl = featureCard.querySelector('.total-votes');

              if (upIndicator && downIndicator) {
                  upIndicator.style.width = `${upPercentage}%`;
                  downIndicator.style.width = `${downPercentage}%`;
              }

              if (totalVotesEl) {
                  const totalVotes = parseInt(featureCard.querySelector('.thumbs-up .count').textContent) +
                      parseInt(featureCard.querySelector('.thumbs-down .count').textContent);
                  totalVotesEl.textContent = totalVotes;
              }
          }

          // Show feedback message
          function showFeedbackMessage(featureCard, message) {
              const feedbackEl = featureCard.querySelector('.feedback-message');
              if (feedbackEl) {
                  feedbackEl.textContent = message;
                  feedbackEl.classList.add('show-message');

                  setTimeout(() => {
                      feedbackEl.classList.remove('show-message');
                  }, 3000);
              }
          }

          thumbsButtons.forEach(button => {
              button.addEventListener('mousedown', createRipple);

              button.addEventListener('click', async function() {
                  const featureId = this.getAttribute('data-feature-id');
                  const isUpvote = this.classList.contains('thumbs-up');
                  const featureCard = this.closest('.feature-card');

                  // Button animation on click
                  this.classList.add('scale-95');
                  setTimeout(() => {
                      this.classList.remove('scale-95');
                  }, 100);

                  try {
                      const formData = new FormData();
                      formData.append('feature_id', featureId);
                      formData.append('vote', isUpvote ? 'up' : 'down');

                      const response = await fetch('{% url "feature_vote" %}', {
                          method: 'POST',
                          body: formData,
                          headers: {
                              'X-CSRFToken': csrfToken
                          }
                      });

                      if (!response.ok) throw new Error('Network response was not ok');
                      const data = await response.json();

                      // Show feedback message
                      showFeedbackMessage(featureCard, data.message || 'Thanks for your feedback!');

                      // Update the counts with animation
                      const upButton = featureCard.querySelector('.thumbs-up');
                      const downButton = featureCard.querySelector('.thumbs-down');

                      if (upButton) {
                          const countElement = upButton.querySelector('.count');
                          countElement.classList.add('count-change');
                          countElement.textContent = data.up_count;
                          setTimeout(() => {
                              countElement.classList.remove('count-change');
                          }, 500);
                      }

                      if (downButton) {
                          const countElement = downButton.querySelector('.count');
                          countElement.classList.add('count-change');
                          countElement.textContent = data.down_count;
                          setTimeout(() => {
                              countElement.classList.remove('count-change');
                          }, 500);
                      }

                      // Update vote percentages
                      updateVotePercentages(featureCard, data.up_percentage || 0, data.down_percentage || 0);

                      // Disable buttons and highlight selected only if this is a new vote, not if they're changing their vote
                      if (data.message !== "Vote changed" && data.message !== "You've already cast this vote") {
                          const parentFeedback = featureCard.querySelector('.flex.space-x-3');
                          parentFeedback.querySelectorAll('button').forEach(btn => {
                              btn.disabled = true;
                              btn.classList.add('opacity-70');
                          });
                      }

                      // Highlight the selected button
                      const parentFeedback = featureCard.querySelector('.flex.space-x-3');
                      parentFeedback.querySelectorAll('button').forEach(btn => {
                          btn.classList.remove('selected');
                      });

                      this.classList.remove('opacity-70');
                      this.classList.add('selected');

                      // Store the vote in localStorage
                      localStorage.setItem(`feature-vote-${featureId}`, isUpvote ? 'up' : 'down');

                  } catch (error) {
                      console.error('Error voting on feature:', error);
                      showFeedbackMessage(featureCard, "Error recording your vote. Please try again.");
                  }
              });
          });

          // Check for existing votes in localStorage and update UI
          thumbsButtons.forEach(button => {
              const featureId = button.getAttribute('data-feature-id');
              const storedVote = localStorage.getItem(`feature-vote-${featureId}`);

              if (storedVote) {
                  const featureCard = button.closest('.feature-card');
                  const parentFeedback = featureCard.querySelector('.flex.space-x-3');

                  if ((storedVote === 'up' && button.classList.contains('thumbs-up')) ||
                      (storedVote === 'down' && button.classList.contains('thumbs-down'))) {
                      button.classList.add('selected');
                  }
              }
          });

          // Animate feature cards on scroll
          const observerOptions = {
              threshold: 0.1,
              rootMargin: '0px 0px 50px 0px'
          };

          const observer = new IntersectionObserver((entries) => {
              entries.forEach(entry => {
                  if (entry.isIntersecting) {
                      entry.target.style.opacity = '1';
                      entry.target.style.transform = 'translateY(0)';
                      observer.unobserve(entry.target);
                  }
              });
          }, observerOptions);

          document.querySelectorAll('.feature-card').forEach(card => {
              card.style.opacity = '0';
              card.style.transform = 'translateY(20px)';
              card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
              observer.observe(card);
          });

          // Fetch initial vote counts
          const fetchVoteCounts = async () => {
              const features = document.querySelectorAll('.feature-card:not(.upcoming-feature)');

              features.forEach(async feature => {
                  const featureId = feature.querySelector('[data-feature-id]')?.getAttribute('data-feature-id');
                  if (!featureId) return;

                  try {
                      const response = await fetch(`{% url 'feature_vote_count' %}?feature_id=${featureId}`);
                      if (response.ok) {
                          const data = await response.json();
                          const upButton = feature.querySelector('.thumbs-up');
                          const downButton = feature.querySelector('.thumbs-down');

                          if (upButton) upButton.querySelector('.count').textContent = data.up_count;
                          if (downButton) downButton.querySelector('.count').textContent = data.down_count;

                          // Update vote percentages
                          updateVotePercentages(feature, data.up_percentage || 0, data.down_percentage || 0);

                          // Update total votes
                          const totalVotesEl = feature.querySelector('.total-votes');
                          if (totalVotesEl) {
                              totalVotesEl.textContent = data.total_votes || 0;
                          }

                          // Check if the user has already voted based on localStorage
                          const featureId = feature.querySelector('[data-feature-id]').getAttribute('data-feature-id');
                          const storedVote = localStorage.getItem(`feature-vote-${featureId}`);

                          if (storedVote) {
                              const parentFeedback = feature.querySelector('.flex.space-x-3');

                              if (storedVote === 'up') {
                                  const upBtn = feature.querySelector('.thumbs-up');
                                  upBtn.classList.add('selected');
                              } else if (storedVote === 'down') {
                                  const downBtn = feature.querySelector('.thumbs-down');
                                  downBtn.classList.add('selected');
                              }
                          }
                      }
                  } catch (error) {
                      console.error('Error fetching vote counts:', error);
                  }
              });
          };

          // Initialize vote counts
          fetchVoteCounts();
      });
  </script>
{% endblock %}
