#!/bin/bash

# Database backup script for {{ project_name }}
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="{{ project_path }}/backups"
BACKUP_FILE="${BACKUP_DIR}/{{ db_name }}_${DATE}.sql"

# Create backup
pg_dump -h {{ db_host }} -p {{ db_port }} -U {{ db_user }} -d {{ db_name }} > "${BACKUP_FILE}"

# Compress backup
gzip "${BACKUP_FILE}"

# Keep only last 7 days of backups
find "${BACKUP_DIR}" -name "{{ db_name }}_*.sql.gz" -mtime +7 -delete

# Log backup completion
echo "$(date): Database backup completed: ${BACKUP_FILE}.gz" >> "${BACKUP_DIR}/backup.log" 